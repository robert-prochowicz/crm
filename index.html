<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wealth Management CRM</title>
    <style>
        /* Reset and Base Styles */
        :root {
            --slate-100: #f1f5f9;
            --slate-300: #cbd5e1;
            --slate-400: #94a3b8;
            --slate-500: #64748b;
            --slate-600: #475569;
            --slate-700: #334155;
            --slate-800: #1e293b;
            --slate-900: #0f172a;
            --blue-100: #dbeafe;
            --blue-600: #2563eb;
            --blue-700: #1d4ed8;
            --green-600: #16a34a;
            --red-600: #dc2626;
            --white: #ffffff;
            --yellow-100: #fef9c3;
            --yellow-800: #854d0e;
            --blue-800: #1e40af;
            --green-100: #dcfce7;
            --green-800: #166534;
            --red-100: #fee2e2;
            --red-800: #991b1b;
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
            background-color: var(--slate-100);
            color: var(--slate-800);
            line-height: 1.5;
        }

        /* Layout */
        .main-content {
            padding: 1rem;
        }
        @media (min-width: 640px) {
            .main-content { padding: 1.5rem; }
        }
        @media (min-width: 1024px) {
            .main-content { padding: 2rem; }
        }
        .max-w-7xl {
            max-width: 80rem;
            margin-left: auto;
            margin-right: auto;
            padding-left: 1rem;
            padding-right: 1rem;
        }

        /* Header */
        .header {
            background-color: var(--slate-800);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 4rem;
        }
        .header-logo {
            display: flex;
            align-items: center;
        }
        .header-title {
            color: var(--white);
            font-size: 1.25rem;
            font-weight: 700;
            margin-left: 0.75rem;
        }
        .header-user {
            display: flex;
            align-items: center;
        }
        .header-user-name {
            color: var(--slate-300);
            margin-right: 1rem;
            display: none;
        }
         @media (min-width: 640px) {
            .header-user-name { display: block; }
        }
        .header-user-avatar {
            height: 2rem;
            width: 2rem;
            border-radius: 9999px;
        }

        /* Titles */
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--slate-700);
            margin-bottom: 1rem;
        }
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--slate-700);
            margin-bottom: 1rem;
        }

        /* Grid */
        .grid {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }
        @media (min-width: 640px) {
            .sm-grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        }
        @media (min-width: 1024px) {
            .lg-grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        }

        /* Cards */
        .card {
            background-color: var(--white);
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            margin-top: 2rem;
        }
        
        .stat-card {
             background-color: var(--white);
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            transition: box-shadow 0.3s;
        }
        .stat-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .stat-card-title {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--slate-500);
        }
        .stat-card-value {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--slate-800);
            margin-top: 0.25rem;
        }
        .stat-card-change {
            font-size: 0.75rem;
            margin-top: 0.5rem;
        }
        .stat-card-change.increase { color: var(--green-600); }
        .stat-card-change.decrease { color: var(--red-600); }
        .stat-card-icon-wrapper {
            background-color: var(--blue-100);
            color: var(--blue-600);
            padding: 0.75rem;
            border-radius: 9999px;
        }

        /* Chart */
        .chart-container {
            width: 100%;
            height: 300px;
            padding: 1rem;
        }

        /* Customer List */
        .customer-list-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
            flex-direction: column;
        }
        @media (min-width: 640px) {
           .customer-list-header {
                flex-direction: row;
                align-items: center;
           }
        }
        .customer-list-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--slate-700);
            margin-bottom: 0.5rem;
        }
        @media (min-width: 640px) {
           .customer-list-title { margin-bottom: 0; }
        }
        .table-container {
            overflow-x: auto;
        }
        .table {
            width: 100%;
            font-size: 0.875rem;
            text-align: left;
            color: var(--slate-500);
        }
        .table thead {
            font-size: 0.75rem;
            color: var(--slate-700);
            text-transform: uppercase;
            background-color: #f8fafc; /* bg-slate-50 */
        }
        .table th, .table td {
            padding: 1rem 1.5rem;
        }
        .table tbody tr {
            background-color: var(--white);
            border-bottom: 1px solid #e2e8f0; /* border-slate-200 */
        }
        .table tbody tr:hover {
            background-color: #f8fafc;
        }
        .table-name {
            font-weight: 500;
            color: var(--slate-900);
            white-space: nowrap;
        }
        .table-contact-email {
             white-space: nowrap;
        }
        .table-contact-phone {
            color: var(--slate-400);
        }
        .status-badge {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 500;
            border-radius: 9999px;
            white-space: nowrap;
        }
        .status-badge.Pending { background-color: var(--yellow-100); color: var(--yellow-800); }
        .status-badge.Contacted { background-color: var(--blue-100); color: var(--blue-800); }
        .status-badge.Converted { background-color: var(--green-100); color: var(--green-800); }
        .status-badge.Rejected { background-color: var(--red-100); color: var(--red-800); }

        /* Forms & Buttons */
        .select-input {
            font-size: 0.75rem;
            border: 1px solid var(--slate-300);
            border-radius: 0.375rem;
            padding: 0.25rem;
        }
        .select-input:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            border-color: var(--blue-600);
            box-shadow: 0 0 0 2px var(--blue-100);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 2.5rem 0;
            color: var(--slate-500);
        }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div id="app">
        <!-- App will be rendered here by JavaScript -->
        <div class="header" id="header-container"></div>
        <main class="main-content">
            <div id="dashboard-container"></div>
            <div id="customer-list-container"></div>
        </main>
    </div>
    <script>
// --- CONFIG & CONSTANTS ---
const CustomerStatus = {
  Pending: 'Pending',
  Contacted: 'Contacted',
  Converted: 'Converted',
  Rejected: 'Rejected',
};

const Icons = {
    Logo: `<svg class="w-8 h-8" style="width: 2rem; height: 2rem; color: white;" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>`,
    Phone: `<svg class="w-6 h-6" style="width: 1.5rem; height: 1.5rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>`,
    DollarSign: `<svg class="w-6 h-6" style="width: 1.5rem; height: 1.5rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8v1m0 6v1m0-10a9 9 0 110 18 9 9 0 010-18z"></path></svg>`,
    Users: `<svg class="w-6 h-6" style="width: 1.5rem; height: 1.5rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197M15 21a6 6 0 006-6v-1a6 6 0 00-9-5.197"></path></svg>`,
    CheckCircle: `<svg class="w-6 h-6" style="width: 1.5rem; height: 1.5rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`,
};

// --- STATE MANAGEMENT ---
let state = {
  customers: [],
};

function setState(newState) {
  state = { ...state, ...newState };
  render();
}

// --- RENDER FUNCTIONS ---

function renderHeader() {
  return `
    <div class="max-w-7xl">
      <div class="header-content">
        <div class="header-logo">
          ${Icons.Logo}
          <h1 class="header-title">Wealth Management CRM</h1>
        </div>
        <div class="header-user">
          <span class="header-user-name">Welcome, Alex</span>
          <img class="header-user-avatar" src="https://picsum.photos/100/100" alt="User Avatar" />
        </div>
      </div>
    </div>
  `;
}

function renderStatCard({ title, value, icon, change, changeType }) {
  return `
    <div class="stat-card">
      <div>
        <p class="stat-card-title">${title}</p>
        <p class="stat-card-value">${value}</p>
        <p class="stat-card-change ${changeType}">${change}</p>
      </div>
      <div class="stat-card-icon-wrapper">
        ${icon}
      </div>
    </div>
  `;
}

function renderSalesChart() {
    const data = [
      { name: 'Jan', AUM: 400, NewInvestments: 240 }, { name: 'Feb', AUM: 300, NewInvestments: 139 },
      { name: 'Mar', AUM: 450, NewInvestments: 380 }, { name: 'Apr', AUM: 278, NewInvestments: 390 },
      { name: 'May', AUM: 510, NewInvestments: 480 }, { name: 'Jun', AUM: 490, NewInvestments: 380 },
    ];
    const maxVal = Math.max(...data.flatMap(d => [d.AUM, d.NewInvestments])) * 1.1;

    const bars = data.map((d, i) => {
        const x = i * (100 / data.length);
        const barWidth = 100 / data.length / 3;
        const h1 = (d.NewInvestments / maxVal) * 100;
        const h2 = (d.AUM / maxVal) * 100;
        return `
            <g transform="translate(${x + barWidth / 2}, 0)">
                <rect x="0" y="${100 - h1}" width="${barWidth}" height="${h1}" fill="#3b82f6" rx="2"><title>New Investments: $${d.NewInvestments}k</title></rect>
                <rect x="${barWidth + 2}" y="${100 - h2}" width="${barWidth}" height="${h2}" fill="#93c5fd" rx="2"><title>AUM: $${d.AUM}k</title></rect>
                <text x="${barWidth}" y="105" dy=".3em" text-anchor="middle" font-size="4" fill="#64748b">${d.name}</text>
            </g>
        `;
    }).join('');

    return `
    <div class="card">
      <h3 class="card-title">Monthly Performance (in thousands)</h3>
       <div class="chart-container">
        <svg viewBox="0 0 100 110" preserveAspectRatio="none" style="width: 100%; height: 100%;">
          ${bars}
        </svg>
       </div>
    </div>
    `;
}

function renderDashboard() {
  const { customers } = state;
  const totalCustomers = customers.length;
  const pendingCalls = customers.filter(c => c.status === CustomerStatus.Pending).length;
  const totalPotential = customers.reduce((sum, c) => sum + c.investmentPotential, 0);
  const contacted = customers.filter(c => c.status !== CustomerStatus.Pending).length;

  const stats = [
    { title: 'Clients to Call', value: pendingCalls.toString(), icon: Icons.Phone, change: '+5 this week', changeType: 'increase' },
    { title: 'Total Potential', value: `$${(totalPotential / 1000000).toFixed(2)}M`, icon: Icons.DollarSign, change: '+2.5% this month', changeType: 'increase' },
    { title: 'Total Clients', value: totalCustomers.toString(), icon: Icons.Users, change: '-1.2% this month', changeType: 'decrease' },
    { title: 'Calls Contacted (30d)', value: contacted.toString(), icon: Icons.CheckCircle, change: '+10 this week', changeType: 'increase' },
  ];

  return `
    <h2 class="section-title">Department Overview</h2>
    <div class="grid sm-grid-cols-2 lg-grid-cols-4">
        ${stats.map(renderStatCard).join('')}
    </div>
    ${renderSalesChart()}
  `;
}

function renderCustomerList() {
    const { customers } = state;

    const tableRows = customers.map(customer => `
        <tr data-id="${customer.id}">
            <td>${customer.timestamp}</td>
            <td class="table-name">${customer.name}</td>
            <td>${customer.age}</td>
            <td>${customer.state}</td>
            <td>
                <div class="table-contact-email">${customer.email}</div>
                <div class="table-contact-phone">${customer.phone}</div>
            </td>
            <td>$${customer.investmentPotential.toLocaleString()}</td>
            <td>
                <span class="status-badge ${customer.status}">
                    ${customer.status}
                </span>
            </td>
            <td>
                <select class="status-select select-input" data-id="${customer.id}">
                    ${Object.values(CustomerStatus).map(status => `
                        <option value="${status}" ${customer.status === status ? 'selected' : ''}>${status}</option>
                    `).join('')}
                </select>
            </td>
        </tr>
    `).join('');

    const table = `
        <table class="table">
            <thead>
                <tr>
                    <th>Timestamp</th><th>Name</th><th>Age</th><th>State</th>
                    <th>Contact</th><th>Potential</th><th>Status</th><th>Actions</th>
                </tr>
            </thead>
            <tbody>${tableRows}</tbody>
        </table>
    `;

    const emptyState = `<div class="empty-state"><p>No customers found. The data file might be missing or empty.</p></div>`;

    return `
    <div class="card">
      <div class="customer-list-header">
        <h2 class="customer-list-title">Customer Call List</h2>
      </div>
      <div class="table-container">
        ${customers.length > 0 ? table : emptyState}
      </div>
    </div>
    `;
}

function render() {
  document.getElementById('header-container').innerHTML = renderHeader();
  document.getElementById('dashboard-container').innerHTML = renderDashboard();
  document.getElementById('customer-list-container').innerHTML = renderCustomerList();
  attachEventListeners();
}

// --- LOGIC & EVENT HANDLING ---

function parseCustomersFromCSV(text) {
    const lines = text.split(/\r\n|\n/).filter(line => line.trim() !== '');
    if (lines.length < 2) return [];

    const headers = lines[0].split(',').map(h => h.trim());
    const required = ['timestamp', 'account_id', 'first_name', 'last_name', 'age', 'phone', 'state'];
    if (required.some(h => !headers.includes(h))) {
        console.error('CSV headers are not as expected.', headers);
        alert('CSV headers are missing or incorrect. Required: ' + required.join(', '));
        return null;
    }

    const customerData = lines.slice(1).map((line, index) => {
      const values = line.split(',');
      if (values.length < headers.length) return null;

      const customerObj = {};
      headers.forEach((header, i) => customerObj[header] = values[i].trim());

      const { first_name, last_name, account_id, phone, timestamp, age, state } = customerObj;
      if (!first_name || !last_name || !account_id) return null;

      return {
        id: parseInt(account_id, 10) || Date.now() + index,
        name: `${first_name} ${last_name}`,
        email: `${first_name.toLowerCase()}.${last_name.toLowerCase()}@example.com`,
        phone,
        investmentPotential: Math.floor(Math.random() * (500000 - 10000 + 1)) + 10000,
        status: CustomerStatus.Pending,
        timestamp,
        age: parseInt(age, 10) || 0,
        state,
      };
    }).filter(c => c !== null);
    
    const uniqueCustomers = Array.from(new Map(customerData.map(c => [c.id, c])).values());
    uniqueCustomers.sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime());
    return uniqueCustomers;
}

function handleStatusChange(event) {
  const customerId = parseInt(event.target.dataset.id, 10);
  const newStatus = event.target.value;
  
  const updatedCustomers = state.customers.map(customer =>
    customer.id === customerId ? { ...customer, status: newStatus } : customer
  );
  setState({ customers: updatedCustomers });
}

function attachEventListeners() {
    document.querySelectorAll('.status-select').forEach(select => {
        select.addEventListener('change', handleStatusChange);
    });
}

async function loadInitialData() {
    try {
        const response = await fetch('wealth_management_customers_short.csv');
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const csvText = await response.text();
        const customers = parseCustomersFromCSV(csvText);
        if (customers) {
            setState({ customers });
        } else {
            render(); 
        }
    } catch (error) {
        console.error("Failed to load or parse initial customer CSV:", error);
        // Render empty state on fetch error so the app is not blank
        setState({ customers: [] });
    }
}

// --- INITIALIZATION ---
document.addEventListener('DOMContentLoaded', loadInitialData);
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>